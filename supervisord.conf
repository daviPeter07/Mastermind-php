; supervisord.conf

[supervisord]
nodaemon=true

; -----------------------------
; Processo 1: Servidor da API
; -----------------------------
[program:api-server]
command=php -S 0.0.0.0:8000 -t public
autostart=true
autorestart=true
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
environment=API_BASE_URL="http://localhost:8000"

; -----------------------------
; Processo 2: Bot do Telegram
; -----------------------------
[program:telegram-bot]
command=php scripts/run-bot.php
autostart=true
autorestart=true
stderr_logfile=/dev/stderr
stderr_logfile_maxbytes=0
stdout_logfile=/dev/stdout
stdout_logfile_maxbytes=0
environment=
    DATABASE_URL="%(ENV_DATABASE_URL)s",
    TELEGRAM_BOT_TOKEN="%(ENV_TELEGRAM_BOT_TOKEN)s",
    MASTERMIND_API_TOKEN="%(ENV_MASTERMIND_API_TOKEN)s",
    POSTGRES_DB="%(ENV_POSTGRES_DB)s",
    POSTGRES_USER="%(ENV_POSTGRES_USER)s",
    POSTGRES_PASSWORD="%(ENV_POSTGRES_PASSWORD)s",
    DB_PORT="%(ENV_DB_PORT)s",
    JWT_SECRET="%(ENV_JWT_SECRET)s"

; -----------------------------
; Processo 3: Teste de ENV
; -----------------------------
[program:test-env]
command=php scripts/test-env.php
autostart=false
